
function selectQuestion(questionID)
{
	window.ResultVisData = undefined;
	window.ResultQuestionID = questionID;
	window.ResultQuestionData = undefined;
	
	$("#detailPanel").hide();
	
	var baseURL = sessionStorage.getItem("baseURL");
	//var url = baseURL + "/results/" + questionID +"/question";
	var url2 = baseURL + "/question/" + questionID;
	var url = baseURL + "/results/" + questionID +"/question";
	
	$.getJSON(url, makeHistogramFromData);
	//$.getJSON(url2, fillInDetailData);
}

function makeHistogramFromData(data,status)
{
	//console.log(data)
	//console.log(success)
	if(status == "success")
	{
		window.ResultVisData = data;

		resultsVis = new VisHistogram("#chartHome" ,data);
		resultsVis.SetupVisualization();
		
		var baseURL = sessionStorage.getItem("baseURL");
		//var url = baseURL + "/results/" + questionID +"/question";
		var url2 = baseURL + "/question/" + window.ResultQuestionID;
		
		$.getJSON(url2, fillInDetailData);
	}
}

function fillInDetailData(data,status)
{
	if(status == "success")
	{
		$("#optionTable").find(".generatedTableRow").remove();
		//console.log(data)
		//dconsole.log(window.ResultVisData)
		
		window.ResultQuestionData = data;
		
		$("#detailPanel").show();
		
		$("#questionTitle").html(sessionStorage.getItem('lectureName') + " | " + data["title"]);
		$("#questionText").html(data["content"]);
		
		var totalResponses = 0
		

		tableHTML = "<tr class=\"generatedTableRow\"><th>Response</th><th>Number of Responses</th><th>Percentage</th>";
		
		if(data["type"] == 1)
			{
			
			}
		
		
		for(var i = 0; i < window.ResultVisData["results"].length; i++)
			{
				totalResponses += getResultCount(window.ResultVisData["results"][i]["id"])
			}
		
		for(var i = 0; i < window.ResultVisData["results"].length; i++)
			{
				var responseCount = getResultCount(window.ResultVisData["results"][i]["id"])
				var responsePercent = (responseCount/totalResponses) * 100
				if(totalResponses == 0) responsePercent = 0;
				tableHTML += "<tr class=\"generatedTableRow\"><td>"+window.ResultVisData["results"][i]["name"]+"</td><td>"+responseCount+"</td><td>"+responsePercent.toFixed(2)+"\%</td></tr>"
			}
		
		//Add rows for aggregate results
		tableHTML += "<tr class=\"generatedTableRow\"><th>Unique Responses</th><th>Total Responses</th><th></th></tr>";
		tableHTML += "<tr class=\"generatedTableRow\"><td>"+window.ResultVisData["results"].length+"</td><td>"+totalResponses+"</td><td></td></tr>";
		
		//
		
		
		
		$("#optionTable").append(tableHTML);
	
	
		
	}
}

function getResultCount(optionId)
{
	var ret = 0;
	
	for(var i = 0; i < window.ResultVisData["results"].length; i ++)
		{
			if(window.ResultVisData["results"][i]["id"] == optionId)
				ret = window.ResultVisData["results"][i]["count"];
		}
	
	return ret
}

function getResponseTextByID(optionId)
{

	for(var i = 0; i < window.ResultVisData["results"].length; i ++)
		{
			if(window.ResultVisData["results"][i]["id"] == optionId)
				ret = window.ResultVisData["results"][i]["count"];
		}
}